<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href="../css/default_reset.css" />
        <link rel="stylesheet" href="../css/game.css" />
        <title>Remake Space Invaders</title>
    </head>
    <body>
        <div class="container-game">
            <canvas id="screen" width="34" height="17"></canvas>
        </div>
    </body>
</html>
<script>
    const screen = document.getElementById("screen");
    const context = screen.getContext("2d");
    const currentPlayerId = "player1";

    // Public Methods of Factories
    const game = create_game();
    const keyboard_listener = create_keyboard_listener();

    // Factory 1
    function create_game(command) {
        const state = {
            players: {
                player1: {
                    x: 16,
                    y: 16,
                },
            },
            aliens: {
                alien1: {
                    x: 10,
                    y: 3,
                },
                alien2: {
                    x: 13,
                    y: 3,
                },
            },
            playerBullet: {
                x: 0,
                y: 0,
            },
            AlienBullet: {
                x: 0,
                y: 0,
            },
        };

        function move_player(command) {
            console.log(
                `Moving ${command.playerId} with ${command.keyPressed}`
            );
            const keyPressed = command.keyPressed;
            const player = state.players[command.playerId];

            if (keyPressed === "ArrowUp" && player.y - 1 >= 0) {
                --player.y;
                return;
            }
            if (keyPressed === "ArrowDown" && player.y + 1 < 17) {
                ++player.y;
                return;
            }
            if (keyPressed === "ArrowLeft" && player.x - 1 >= 0) {
                --player.x;
                return;
            }
            if (keyPressed === "ArrowRight" && player.x + 1 < screen.width) {
                ++player.x;
                return;
            }
        }
        return {
            move_player,
            state,
        };
    }
    // TODO: Implementar os Objetos dos Projeteis dos Aliens e Players

    render_screen();

    function render_screen() {
        context.clearRect(0, 0, screen.width, screen.height);

        for (const playerId in game.state.players) {
            const player = game.state.players[playerId];
            context.fillStyle = "#42e9f4";
            context.fillRect(player.x, player.y, 1, 1);
        }
        for (const alienId in game.state.aliens) {
            const alien = game.state.aliens[alienId];
            context.fillStyle = "#62de6d";
            context.fillRect(alien.x, alien.y, 1, 1);
        }
        requestAnimationFrame(render_screen);
    }

    // Input Layer

    function create_keyboard_listener() {
        document.addEventListener("keydown", input_key_down);

        function input_key_down(event) {
            const keyPressed = event.key;

            const command = {
                playerId: "player1",
                keyPressed,
            };

            game.move_player(command);
        }
    }
</script>
